<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EveryLingua AI - Motorcycle Dealership Voice Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .waveform {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 40px;
        }
        .waveform-bar {
            width: 4px;
            margin: 0 2px;
            background: #3b82f6;
            animation: wave 1.5s ease-in-out infinite;
        }
        .waveform-bar:nth-child(1) { animation-delay: 0s; height: 10px; }
        .waveform-bar:nth-child(2) { animation-delay: 0.1s; height: 20px; }
        .waveform-bar:nth-child(3) { animation-delay: 0.2s; height: 30px; }
        .waveform-bar:nth-child(4) { animation-delay: 0.3s; height: 25px; }
        .waveform-bar:nth-child(5) { animation-delay: 0.4s; height: 35px; }
        @keyframes wave {
            0%, 100% { transform: scaleY(1); }
            50% { transform: scaleY(0.3); }
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <!-- Header -->
    <header class="gradient-bg py-6 px-4">
        <div class="container mx-auto text-center">
            <h1 class="text-4xl font-bold mb-2">
                <i class="fas fa-motorcycle mr-3"></i>
                EveryLingua AI
            </h1>
            <p class="text-xl opacity-90">Motorcycle Dealership Voice Assistant</p>
            <div class="mt-4 flex justify-center items-center space-x-4">
                <div class="flex items-center space-x-2 glass-effect px-4 py-2 rounded-full">
                    <div id="status-indicator" class="w-3 h-3 bg-red-500 rounded-full"></div>
                    <span id="status-text" class="text-sm">Initializing...</span>
                </div>
                <div class="glass-effect px-4 py-2 rounded-full">
                    <span id="current-language" class="text-sm">Language: English</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <!-- Voice Interface Card -->
            <div class="glass-effect rounded-2xl p-8 mb-8">
                <div class="text-center mb-8">
                    <h2 class="text-2xl font-semibold mb-4">Voice Interface</h2>
                    <p class="text-gray-300 mb-6">Click the microphone button and speak your query</p>

                    <!-- Voice Controls -->
                    <div class="flex justify-center items-center space-x-6 mb-8">
                        <button id="start-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-4 rounded-full text-lg font-semibold transition-all duration-300 transform hover:scale-105">
                            <i class="fas fa-microphone mr-2"></i>
                            Start Listening
                        </button>

                        <button id="stop-btn" class="bg-red-600 hover:bg-red-700 text-white px-8 py-4 rounded-full text-lg font-semibold transition-all duration-300 transform hover:scale-105 hidden">
                            <i class="fas fa-stop mr-2"></i>
                            Stop
                        </button>
                    </div>

                    <!-- Waveform Animation -->
                    <div id="waveform" class="waveform hidden">
                        <div class="waveform-bar"></div>
                        <div class="waveform-bar"></div>
                        <div class="waveform-bar"></div>
                        <div class="waveform-bar"></div>
                        <div class="waveform-bar"></div>
                    </div>

                    <!-- Processing Indicator -->
                    <div id="processing" class="hidden text-center">
                        <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mb-2"></div>
                        <p class="text-gray-300">Processing your request...</p>
                    </div>
                </div>

                <!-- Language Selection -->
                <div class="mb-8">
                    <h3 class="text-lg font-semibold mb-4 text-center">Select Language</h3>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                        <button class="language-btn bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg transition-all duration-200" data-lang="en-US,en">English</button>
                        <button class="language-btn bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg transition-all duration-200" data-lang="hi-IN,hi">हिंदी</button>
                        <button class="language-btn bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg transition-all duration-200" data-lang="mr-IN,mr">मराठी</button>
                        <button class="language-btn bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg transition-all duration-200" data-lang="gu-IN,gu">ગુજરાતી</button>
                        <button class="language-btn bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg transition-all duration-200" data-lang="ta-IN,ta">தமிழ்</button>
                        <button class="language-btn bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg transition-all duration-200" data-lang="te-IN,te">తెలుగు</button>
                        <button class="language-btn bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg transition-all duration-200" data-lang="kn-IN,kn">ಕನ್ನಡ</button>
                        <button class="language-btn bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg transition-all duration-200" data-lang="bn-IN,bn">বাংলা</button>
                    </div>
                </div>
            </div>

            <!-- Conversation Display -->
            <div class="glass-effect rounded-2xl p-6">
                <h3 class="text-xl font-semibold mb-4">Conversation</h3>
                <div id="conversation" class="space-y-4 max-h-96 overflow-y-auto">
                    <div class="text-center text-gray-400 py-8">
                        <i class="fas fa-comments text-3xl mb-2"></i>
                        <p>Start a conversation by clicking the microphone button above</p>
                    </div>
                </div>
            </div>

            <!-- Quick Actions for Dealership -->
            <div class="mt-8">
                <h3 class="text-xl font-semibold mb-4 text-center">Quick Actions</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <button class="dealership-btn glass-effect p-4 rounded-xl hover:bg-opacity-20 transition-all duration-200" data-action="bike-models">
                        <i class="fas fa-motorcycle text-2xl mb-2 text-blue-400"></i>
                        <h4 class="font-semibold">Bike Models</h4>
                        <p class="text-sm text-gray-300">Explore available motorcycles</p>
                    </button>

                    <button class="dealership-btn glass-effect p-4 rounded-xl hover:bg-opacity-20 transition-all duration-200" data-action="service-booking">
                        <i class="fas fa-tools text-2xl mb-2 text-green-400"></i>
                        <h4 class="font-semibold">Service Booking</h4>
                        <p class="text-sm text-gray-300">Book a service appointment</p>
                    </button>

                    <button class="dealership-btn glass-effect p-4 rounded-xl hover:bg-opacity-20 transition-all duration-200" data-action="test-ride">
                        <i class="fas fa-road text-2xl mb-2 text-purple-400"></i>
                        <h4 class="font-semibold">Test Ride</h4>
                        <p class="text-sm text-gray-300">Schedule a test ride</p>
                    </button>

                    <button class="dealership-btn glass-effect p-4 rounded-xl hover:bg-opacity-20 transition-all duration-200" data-action="finance">
                        <i class="fas fa-calculator text-2xl mb-2 text-yellow-400"></i>
                        <h4 class="font-semibold">Finance Options</h4>
                        <p class="text-sm text-gray-300">Calculate EMI and finance</p>
                    </button>

                    <button class="dealership-btn glass-effect p-4 rounded-xl hover:bg-opacity-20 transition-all duration-200" onclick="window.open('/dealer_locator.html', '_blank')">
                        <i class="fas fa-map-marker-alt text-2xl mb-2 text-red-400"></i>
                        <h4 class="font-semibold">Find Dealer</h4>
                        <p class="text-sm text-gray-300">Interactive dealer locator</p>
                    </button>

                    <button class="dealership-btn glass-effect p-4 rounded-xl hover:bg-opacity-20 transition-all duration-200" data-action="contact-support">
                        <i class="fas fa-headset text-2xl mb-2 text-indigo-400"></i>
                        <h4 class="font-semibold">Support</h4>
                        <p class="text-sm text-gray-300">Contact customer support</p>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="gradient-bg py-4 px-4 mt-12">
        <div class="container mx-auto text-center">
            <p class="text-sm opacity-75">
                Powered by <strong>EveryLingua AI</strong> | Gemini 2.5 Pro | Multilingual Voice Assistant
            </p>
        </div>
    </footer>

    <script>
        // Voice Assistant JavaScript
        class VoiceAssistantUI {
            constructor() {
                this.isListening = false;
                this.currentLanguage = ['en-US', 'en'];
                this.recognition = null;
                this.synth = window.speechSynthesis;
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.updateStatus('Ready', 'green');
                this.setupSpeechRecognition();
            }

            setupEventListeners() {
                document.getElementById('start-btn').addEventListener('click', () => this.startListening());
                document.getElementById('stop-btn').addEventListener('click', () => this.stopListening());

                // Language selection
                document.querySelectorAll('.language-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const langData = e.target.dataset.lang.split(',');
                        this.setLanguage(langData);
                    });
                });

                // Dealership quick actions
                document.querySelectorAll('.dealership-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const action = e.currentTarget.dataset.action;
                        this.handleQuickAction(action);
                    });
                });
            }

            setupSpeechRecognition() {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    this.recognition = new SpeechRecognition();
                    this.recognition.continuous = false;
                    this.recognition.interimResults = false;
                    this.recognition.lang = this.currentLanguage[0];

                    this.recognition.onstart = () => {
                        this.isListening = true;
                        this.updateStatus('Listening...', 'blue');
                        this.showWaveform();
                    };

                    this.recognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        this.addMessage('user', transcript);
                        this.processQuery(transcript);
                    };

                    this.recognition.onerror = (event) => {
                        console.error('Speech recognition error:', event.error);
                        this.updateStatus('Error', 'red');
                        this.hideWaveform();
                    };

                    this.recognition.onend = () => {
                        this.isListening = false;
                        this.updateStatus('Ready', 'green');
                        this.hideWaveform();
                        if (this.continueListening) {
                            setTimeout(() => this.startListening(), 1000);
                        }
                    };
                } else {
                    this.updateStatus('Speech recognition not supported', 'red');
                }
            }

            startListening() {
                if (this.recognition && !this.isListening) {
                    this.continueListening = true;
                    document.getElementById('start-btn').classList.add('hidden');
                    document.getElementById('stop-btn').classList.remove('hidden');
                    this.recognition.start();
                }
            }

            stopListening() {
                if (this.recognition && this.isListening) {
                    this.continueListening = false;
                    this.recognition.stop();
                    document.getElementById('start-btn').classList.remove('hidden');
                    document.getElementById('stop-btn').classList.add('hidden');
                }
            }

            setLanguage(langData) {
                this.currentLanguage = langData;
                document.getElementById('current-language').textContent = `Language: ${langData[1]}`;
                if (this.recognition) {
                    this.recognition.lang = langData[0];
                }
                this.addMessage('system', `Language switched to ${langData[1]}`);
            }

            showWaveform() {
                document.getElementById('waveform').classList.remove('hidden');
            }

            hideWaveform() {
                document.getElementById('waveform').classList.add('hidden');
            }

            updateStatus(text, color) {
                const indicator = document.getElementById('status-indicator');
                const statusText = document.getElementById('status-text');

                indicator.className = `w-3 h-3 rounded-full bg-${color}-500`;
                statusText.textContent = text;
            }

            addMessage(sender, text) {
                const conversation = document.getElementById('conversation');
                const messageDiv = document.createElement('div');
                messageDiv.className = `p-3 rounded-lg ${
                    sender === 'user' ? 'bg-blue-600 ml-12' :
                    sender === 'system' ? 'bg-gray-600 mx-12 text-center' :
                    'bg-gray-700 mr-12'
                }`;

                const icon = sender === 'user' ? 'fas fa-user' : 'fas fa-robot';
                messageDiv.innerHTML = `<i class="${icon} mr-2"></i>${text}`;
                conversation.appendChild(messageDiv);
                conversation.scrollTop = conversation.scrollHeight;
            }

            async processQuery(query) {
                this.showProcessing();

                try {
                    // Send query to backend (Python voice assistant)
                    const response = await this.sendToBackend(query);
                    this.addMessage('assistant', response);

                    // Speak the response
                    this.speakText(response);

                } catch (error) {
                    console.error('Error processing query:', error);
                    this.addMessage('system', 'Sorry, I encountered an error. Please try again.');
                } finally {
                    this.hideProcessing();
                }
            }

            async sendToBackend(query) {
                try {
                    // Send query to Flask backend
                    const response = await fetch('/api/chat', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ message: query })
                    });

                    const data = await response.json();

                    if (data.success) {
                        return data.response;
                    } else {
                        throw new Error(data.error || 'Backend error');
                    }
                } catch (error) {
                    console.error('Backend connection error:', error);
                    return `I understand you said: "${query}". I'm having trouble connecting to the backend right now. Please try again later.`;
                }
            }

            speakText(text) {
                if (this.synth) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = this.currentLanguage[0];
                    utterance.rate = 0.9;
                    utterance.pitch = 1;
                    this.synth.speak(utterance);
                }
            }

            showProcessing() {
                document.getElementById('processing').classList.remove('hidden');
            }

            hideProcessing() {
                document.getElementById('processing').classList.add('hidden');
            }

            handleQuickAction(action) {
                let query = '';
                switch(action) {
                    case 'bike-models':
                        query = 'Show me available bike models';
                        break;
                    case 'service-booking':
                        query = 'I want to book a service appointment';
                        break;
                    case 'test-ride':
                        query = 'Schedule a test ride';
                        break;
                    case 'finance':
                        query = 'Tell me about finance options';
                        break;
                    case 'locate-dealer':
                        query = 'Find nearest dealer location';
                        break;
                    case 'contact-support':
                        query = 'Connect me to customer support';
                        break;
                }
                this.addMessage('user', query);
                this.processQuery(query);
            }
        }

        // Initialize the voice assistant when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            new VoiceAssistantUI();
        });
    </script>
</body>
</html>
